#!/usr/bin/env node

/**
 * A script to copy media assets for development mode.
 * Run this before starting the dev server if thumbnails aren't appearing.
 */
import { copyFile, mkdir } from 'fs/promises';
import { resolve, dirname } from 'path';
import { fileURLToPath } from 'url';
import fs from 'fs';
import path from 'path';

const __dirname = dirname(fileURLToPath(import.meta.url));

// Function to copy all assets from _media to .vitepress/dist/media
async function copyMediaAssets() {
  try {
    // Create the dev server directory structure
    await mkdir(resolve(__dirname, 'docs/.vitepress/dist/media'), { recursive: true });
    await mkdir(resolve(__dirname, 'docs/.vitepress/dist/media/thumbnails'), { recursive: true });
    
    // Copy placeholder assets
    await copyFile(
      resolve(__dirname, 'docs/_media/audio-placeholder.svg'),
      resolve(__dirname, 'docs/.vitepress/dist/media/audio-placeholder.svg')
    );
    
    await copyFile(
      resolve(__dirname, 'docs/_media/video-placeholder.svg'),
      resolve(__dirname, 'docs/.vitepress/dist/media/video-placeholder.svg')
    );
    
    await copyFile(
      resolve(__dirname, 'docs/_media/generic-placeholder.svg'),
      resolve(__dirname, 'docs/.vitepress/dist/media/generic-placeholder.svg')
    );
    
    // Copy all thumbnails
    const thumbnailsDir = resolve(__dirname, 'docs/_media/thumbnails');
    const thumbnailsDestDir = resolve(__dirname, 'docs/.vitepress/dist/media/thumbnails');
    
    // Get all files in the thumbnails directory
    const files = fs.readdirSync(thumbnailsDir);
    
    // Copy each file to the destination directory
    for (const file of files) {
      await copyFile(
        path.join(thumbnailsDir, file),
        path.join(thumbnailsDestDir, file)
      );
    }
    
    console.log('Media assets copied successfully to dev server directory');
  } catch (error) {
    console.error('Error copying media assets:', error);
  }
}

// Run the copy function
copyMediaAssets();
